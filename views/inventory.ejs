<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts - Roboto -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap">
    <!-- Icons -->
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--BootStrap 4-->
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/inventory.css">
    <link rel="stylesheet" type="text/css" href="/css/modal.css">

    <title>Stashed</title>

    <!-- Chart js cdn -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>

<body>
    <nav id="navbar" class="align-middle navbar navbar-dark navbar-expand-md fixed-top">
        <a id="navbar-logo" class="navbar-brand" href="#">
            <img src="/images/Icon2.png" width="50" height="50" class="align-middle">
        </a>

        <!-- Collapse Nav When Dimensions Shrink -->
        <button class="navbar-toggler custom-toggler" data-toggle="collapse" data-target="#navLinks">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!--NavBar Links-->
        <div id="navLinks" class="collapse navbar-collapse">
            <!--Right Side Nav Bar-->
            <ul class="navbar-nav ml-auto" style="background-color: rgba(33, 34, 51, 0.7); padding: 10px 15px; border-radius: 25px; margin-right: 20px;">
                <li class="nav-item d-flex">
                    <a class="nav-link align-self-center" href="#statistics"><strong>Statistics</strong></a>
                </li>
            </ul>
            <ul class="navbar-nav d-none d-sm-flex" style="background-color: rgba(33, 34, 51, 0.7); padding: 0px 25px 0px 15px; border-radius: 25px;">
                <li class=" nav-item">
                    <a class="nav-link" href="">
                        <img src="<%= currentUser.discordImage %>" style="border-radius: 25px" width="50" height="50">
                    </a>
                </li>
                <li class="nav-item d-flex">
                    <h5 class="align-self-center" style="margin: 0;"><%= currentUser.name %></h5>
                </li>
            </ul>
        </div>
    </nav>

    <section id="inventory">
        <div class="container-fluid d-flex justify-content-center" style="height: 100%;">
            <div class="row align-items-center justify-content-around" style="width:100%;">

                <div id="inventory-list" class="inventory-block col-12 col-lg-5">
                    <div class="d-flex">
                        <h4>Inventory</h4>
                        <%- include("./newItemModal") %>

                        <div class="inventory-scroll-list">
                            <!-- Each Item -->
                            <% itemList.forEach((item) => { %>
                            <!-- model for each item object -->
                            <%- include("./itemDisplay", {item}); %>
                            <% }) %>
                        </div>
                    </div>

                    <div id="sale-list" class="inventory-block col-12 col-lg-6">

                        <div class="d-flex">
                            <h4>Sales</h4>
                            <%- include("./newSaleModal") %>
                        </div>

                        <div class="sale-scroll-list">

                            <!-- Each Sale -->
                            <% saleList.forEach((sale) => { %>
                            <!-- model for each sale object -->
                            <%- include("./saleDisplay", {sale}); %>
                            <% }) %>
                        </div>
                    </div>

                    <div class=" inventory-block col-12 col-lg-11" style="height: auto;">
                        <h4>Statistics</h4>
                        <div class="row d-flex justify-content-center justify-content-lg-around" style="width: 100%; height: 90%; margin: 0;">
                            <div class="col-12 col-lg-4 statistics-sections d-flex align-content-center flex-column">
                                <div class="statistics-text-block">
                                    <div class="statistics-text">
                                        Number of items in inventory
                                    </div>
                                    <div class="statistics-text-highlighted">
                                        <%=itemList.length%>
                                    </div>
                                </div>
                                <div class="statistics-text-block">
                                    <div class="statistics-text">
                                        Value of Inventory
                                    </div>
                                    <div class="statistics-text-highlighted">
                                        <% let inventoryTotal = 0; %>
                                        <% itemList.forEach((item) => { %>
                                        <% inventoryTotal += parseFloat(item.purchasedPrice) %>
                                        <% }) %>
                                        <%= new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(inventoryTotal) %>
                                    </div>
                                </div>
                                <div class="statistics-text-block">
                                    <div class="statistics-text">
                                        Number of Sales
                                    </div>
                                    <div class="statistics-text-highlighted">
                                        <%=saleList.length%>
                                    </div>
                                </div>
                                <div class="statistics-text-block">
                                    <div class="statistics-text">
                                        Net Sales
                                    </div>
                                    <div class="statistics-text-highlighted">
                                        <% let saleTotal = 0; %>
                                        <% saleList.forEach((sale) => { %>
                                        <% saleTotal += parseFloat(sale.soldPrice) %>
                                        <% }) %>
                                        <%= new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(saleTotal) %>
                                    </div>
                                </div>
                                <div id="statistics" class="statistics-text-block">
                                    <div class="statistics-text">
                                        Profit
                                    </div>
                                    <div class="statistics-text-highlighted" style="color:rgb(74, 255, 147)">
                                        <% let profitTotal = 0; %>
                                        <% saleList.forEach((sale) => { %>
                                        <% profitTotal += parseFloat(sale.profit) %>
                                        <% }) %>
                                        <%= new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(profitTotal) %>
                                    </div>
                                </div>
                            </div>


                            <!-- graph -->
                            <div class="col-12 col-lg-7 statistics-sections" style="padding: 30px; background-color: rgb(45, 47, 73);">
                                <canvas id="myChart" width="100%" height="100%"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </section>


    <!-- Scripts -->
    <script src="/js/ejs.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="/js/inventory.js"></script>

    <script type="text/javascript">
        const ctx = document.getElementById('myChart');
        var sales = ['<%- JSON.stringify(saleList) %>']
        console.log(sales)
        // const saleProfits = []
        // // saleList.forEach(sale => {
        // //     if (saleProfits.length === 0) {
        // //         saleProfit.push(sale.profit)
        // //     } else {
        // //         saleProfit.push(saleProfit[-1] + sale.profit)
        // //     }
        // // });
        // // console.log(saleProfit)
        // const myChart = new Chart(ctx, {
        //     type: 'line',
        //     data: {
        //         labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
        //         datasets: [{
        //             label: 'Sales Chart',
        //             data: [12, 19, 3, 5, 2, 3],
        //             backgroundColor: [
        //                 'rgba(255, 99, 132, 0.2)',
        //                 'rgba(54, 162, 235, 0.2)',
        //                 'rgba(255, 206, 86, 0.2)',
        //                 'rgba(75, 192, 192, 0.2)',
        //                 'rgba(153, 102, 255, 0.2)',
        //                 'rgba(255, 159, 64, 0.2)'
        //             ],
        //             borderColor: [
        //                 'rgba(255, 99, 132, 1)',
        //                 'rgba(54, 162, 235, 1)',
        //                 'rgba(255, 206, 86, 1)',
        //                 'rgba(75, 192, 192, 1)',
        //                 'rgba(153, 102, 255, 1)',
        //                 'rgba(255, 159, 64, 1)'
        //             ],
        //             borderWidth: 5
        //         }]
        //     },
        //     options: {
        //         scales: {
        //             yAxes: [{
        //                 ticks: {
        //                     beginAtZero: true
        //                 }
        //             }]
        //         }
        //     }
        // });
    </script>
</body>

</html>